# 0033 – Ticker & ACTIVITY: culori, sursă unică, WebSocket, hover timestamp, spațiere

## Context

Pe pagina CEA Cash (Cash Market Pro): tickerul „Recent Trades” și div-ul ACTIVITY trebuie să folosească aceleași culori (verde = cumpărare, roșu = vânzare), aceeași sursă de date, actualizare simultană prin WebSocket, timestamp complet la hover în ACTIVITY și spațiere uniformă în ACTIVITY.

## Modificări

### Backend

- **`backend/app/api/v1/cash_market.py`**
  - `get_recent_trades`: încarcă `buy_order` și `sell_order` (joinedload). Side = agresor: `BUY` dacă `buy_order.created_at >= sell_order.created_at`, altfel `SELL`. Răspunsul include câmpul real `side`.
  - După `place_order` (limit): în plus față de `orderbook_updated`, trimite `trade_executed` pentru fiecare match (id, certificate_type, price, quantity, side, executed_at) către toți clienții WS.
- **`backend/app/services/limit_order_matching.py`**
  - `MatchResult`: câmp nou `executed_at: datetime`, setat la crearea trade-ului.
  - La append în `matches`, se trece `executed_at=trade.executed_at`.

### Frontend

- **`frontend/src/pages/CashMarketProPage.tsx`**
  - **Ticker**: folosește `trade.side` (BUY/SELL) când există; fallback pe inferență din preț vs mid. Verde (emerald) pentru BUY, roșu pentru SELL, aliniat cu ACTIVITY.
  - **ACTIVITY**: componentă nouă `RecentTradesActivity` – aceeași listă `recentTrades`, afișare verticală: badge BUY/SELL, cantitate @ preț, total EUR (verde/roșu), timp relativ. La hover pe timp: `title={formatFullTimestamp(trade.executedAt)}` (timestamp complet, ex. „Feb 14, 2026, 1:22:08 AM UTC”). Spațiere: `flex flex-col gap-2` (fără margin suplimentar între prima și a doua rând).
  - Layout: ticker (lg:col-span-8) + ACTIVITY (lg:col-span-4), sursă comună `recentTrades`.
- **`frontend/src/hooks/useCashMarket.ts`**
  - Listener `nihao:tradeExecuted`: la primire, prepend trade la `recentTrades` și păstrează maxim 20. Ticker și ACTIVITY se actualizează din aceeași stare, în același timp.
- **`frontend/src/hooks/useClientRealtime.ts`**
  - Mesaj WS `trade_executed`: normalizare payload (id, certificateType, price, quantity, side, executedAt) și dispatch `nihao:tradeExecuted` cu `{ trade }`.
- **`frontend/src/services/api.ts`**
  - `ClientWebSocketMessage.type`: adăugat `'trade_executed'`. `data`: câmpuri opționale id, price, quantity, side, executedAt pentru trade.

## Sursă unică și WebSocket

- Ticker și ACTIVITY citesc amândouă `recentTrades` din `useCashMarket` (sursă unică).
- La `orderbook_updated`: `fetchData()` reîmprospătează order book + `recentTrades`; ambele componente se re-renderează cu noile date.
- La `trade_executed`: handler-ul din `useCashMarket` face prepend la `recentTrades`; ticker și ACTIVITY se actualizează simultan, fără așteptarea refetch-ului.

## Reguli

- Conform `app_truth.md` și `frontend/docs/DESIGN_SYSTEM.md`: culori emerald pentru BUY, red pentru SELL; fără slate/gray.
- Nu se modifică fișiere din lista „frozen” din `app_truth.md` §10.
