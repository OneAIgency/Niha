# 0023 – AML Users: Cash (EUR) Card “UNDER AML APPROVAL” and Yellow Background

## Context

For users with role **AML**, on the **Portfolio Dashboard**, the **Cash (EUR)** summary card must:

1. Show the amount confirmed by backoffice as received (current behaviour).
2. In the same secondary line as “Total deposited: €X” (DOM: `div.text-xs.text-navy-500.mt-2.shrink-0.min-w-0.truncate`), display the mention **“UNDER AML APPROVAL”**.
3. Apply a **yellow background at 50% opacity** to the Cash (EUR) card when the user role is AML.

User requirements (verbatim):

- Card: “Cash (EUR) … Total deposited: €12,999,100.00” — for AML, show the confirmed amount with the mention “UNDER AML APPROVAL” in that secondary line.
- Card container: “are un background color galben opacity 50%” when in this AML state.

---

## Scope

### In scope

- **DashboardPage.tsx** — Cash (EUR) card only (the first `content_wrapper dashboard-summary-card` after Total Portfolio Value, ~lines 681–715).
- Conditional behaviour when `user.role === 'AML'`:
  - Card wrapper: add background yellow (amber) at 50% opacity (design tokens: use Tailwind `amber`, e.g. `bg-amber-500/50` per design system).
  - Secondary line (same DOM path as “Total deposited: €X”): show **“UNDER AML APPROVAL”** (and optionally keep “Total deposited: €X” in the same block, or replace; plan leaves choice to implementation as long as “UNDER AML APPROVAL” is clearly visible in that area).

### Out of scope

- No new API or backend changes; use existing `entityBalance` / `portfolio` and `useAuthStore().user.role`.
- No changes to other dashboard cards or frozen files.

---

## Files and Functions

### 1. `frontend/src/pages/DashboardPage.tsx`

- **Cash (EUR) card** (`motion.div` with `className="content_wrapper dashboard-summary-card ..."`):
  - **Condition:** `user?.role === 'AML'`.
  - **Card background:** When AML, add a yellow/amber background at 50% opacity. Use design tokens only (e.g. `bg-amber-500/50` or equivalent from `design-tokens.css` / Tailwind theme). Ensure the card content remains readable (contrast).
  - **Secondary line:** The existing block that renders “Total deposited: {formatCurrency(entityBalance.totalDeposited, 2)}” (inside `div.text-xs.text-navy-500.mt-2.shrink-0.min-w-0.truncate`). When AML, show the text **“UNDER AML APPROVAL”** in that same area. Implementation may show only “UNDER AML APPROVAL” or “Total deposited: €X · UNDER AML APPROVAL” as long as “UNDER AML APPROVAL” is present and visible.

- **User source:** `const { user } = useAuthStore();` is already used in this page (e.g. line 202); use `user?.role === 'AML'` for the condition.

### 2. Design system / tokens

- **Colors:** Use Tailwind tokens only (no hardcoded hex). Amber/warning is already in use (e.g. CEA, SETTLING card). Use `amber-500/50` or an existing token for “yellow 50% opacity” so the card has a distinct AML state without breaking theme.
- **Reference:** `frontend/docs/DESIGN_SYSTEM.md`, `frontend/src/styles/design-tokens.css`; follow interface rules from `docs/commands/interface.md`.

---

## Algorithm / Logic

1. In `DashboardPage`, the Cash (EUR) card is already rendered with `entityBalance` and `portfolio`; no new data fetch.
2. Derive `isAmlUser = user?.role === 'AML'`.
3. For the Cash (EUR) card wrapper:
   - If `isAmlUser`: add classes (or style) for background yellow/amber 50% opacity.
   - Else: keep current card styling.
4. For the secondary line (Total deposited / UNDER AML APPROVAL):
   - If `isAmlUser`: render “UNDER AML APPROVAL” in the same `div` (and optionally “Total deposited: €X” before or after).
   - Else: keep current “Total deposited: {formatCurrency(entityBalance.totalDeposited, 2)}” (and existing conditional so the line only shows when `entityBalance?.totalDeposited > 0` if that condition exists).
5. No mock or demo data; all values from existing API and auth store.

---

## Consistency

- **app_truth.md:** User role is SSOT; AML is a valid role; dashboard is allowed for AML (e.g. §8 DashboardRoute).
- **ROLE_TRANSITIONS.md:** No role transition logic required for this UI-only change.
- **Frozen files:** No changes under `frontend/src/pages/onboarding/*`, `LoginPage`, `Onboarding1Page`, etc.
