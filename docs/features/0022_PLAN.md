# 0022 – AML Users: Header Shows DASHBOARD Instead of FUNDING

**Implementation status:** Done (header, redirect, route, and tests updated).

---

## Context

For users with role **AML**, the header navigation should show **DASHBOARD** instead of **FUNDING**. Post-login redirect should also send AML users to the dashboard.

User requirements (verbatim):

- *"pentru user cu role AML, in header nu mai apare FUNDING ci DASHBOARD"*

---

## Behavior (before fix → after fix, implemented)

| Role | Header nav (before → after) | Post-login redirect (before → after) |
|------|-----------------------------|--------------------------------------|
| AML  | FUNDING → **DASHBOARD**     | /funding → **/dashboard**            |
| CEA+ | DASHBOARD, FUNDING, …       | /dashboard, /swap, … (unchanged)     |

Before fix: `canFunding` included AML; `canDashboard` excluded AML; Dashboard route did not allow AML. After fix: AML has DASHBOARD in header, redirect to /dashboard, and access to /dashboard.

---

## Scope

### In scope

- Header nav: AML sees DASHBOARD, not FUNDING
- Post-login redirect: AML → /dashboard (not /funding)
- Dashboard route: allow AML to access /dashboard
- Tests: redirect.test.ts

### Out of scope

- Frozen files: no changes.

---

## Files and Functions Changed (implemented)

### 1. `frontend/src/components/layout/Header.tsx`

- `canDashboard` — includes `'AML'`: `['AML', 'CEA', 'CEA_SETTLE', 'SWAP', 'EUA_SETTLE', 'EUA', 'MM']`
- `canFunding` — does not include `'AML'`: `['APPROVED', 'FUNDING', 'CEA', 'CEA_SETTLE', 'SWAP', 'EUA_SETTLE', 'EUA', 'MM']`

### 2. `frontend/src/utils/redirect.ts`

- AML handled separately: `if (user.role === 'AML') return '/dashboard';` (before APPROVED/FUNDING check).

### 3. `frontend/src/App.tsx`

- **DashboardRoute**: `allowedRoles` includes `'AML'`: `['AML', 'CEA', 'CEA_SETTLE', 'SWAP', 'EUA_SETTLE', 'EUA', 'ADMIN', 'MM']`
- **ApprovedRoute**: `allowedRoles` does NOT include `'AML'` — AML has no access to /funding.

### 4. `frontend/src/utils/__tests__/redirect.test.ts`

- Test: `it('sends AML users to /dashboard', () => { expect(getPostLoginRedirect(makeUser({ role: 'AML' }))).toBe('/dashboard'); });`

---

## Consistency Notes

- **ApprovedRoute** (funding page): AML removed from `allowedRoles` — AML has no access to /funding.
- **app_truth.md / ROLE_TRANSITIONS.md**: no change; AML role semantics unchanged.
- **DESIGN_SYSTEM.md**: no change.

---

## Verification

1. Run frontend tests: `cd frontend && npm test`
2. Login as AML user → should redirect to /dashboard
3. Header nav should show DASHBOARD and not FUNDING for AML
4. AML user can access /dashboard without redirect
